const express = require('express'); const http = require('http'); const { Server } = require('socket.io'); const app = express(); const server = http.createServer(app); const io = new Server(server); let history = []; io.on('connection', (socket) => { socket.emit('chat history', history); socket.on('set username', (username) => { socket.username = username; io.emit('chat message', { user: 'Система', text: username + ' вошел в чат', time: new Date().toLocaleTimeString() }); }); socket.on('typing', (isTyping) => { socket.broadcast.emit('user typing', { user: socket.username, typing: isTyping }); }); socket.on('chat message', (text) => { const msg = { user: socket.username || 'Аноним', text: text, time: new Date().toLocaleTimeString() }; history.push(msg); if(history.length > 50) history.shift(); io.emit('chat message', msg); }); }); app.get('/', (req, res) => { res.sendFile(__dirname + '/index.html'); }); server.listen(3000, () => { console.log('Чат v3.5 с индикатором печати запущен!'); });
