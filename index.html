<!DOCTYPE html><html><head><meta name='viewport' content='width=device-width, initial-scale=1'><title>MyChat Pro</title><style>body{font-family:sans-serif;background:#d1e8ff;margin:0;display:flex;flex-direction:column;height:100vh}#messages{flex-grow:1;overflow-y:auto;padding:15px;display:flex;flex-direction:column;gap:8px;list-style:none;margin:0}li{max-width:75%;padding:10px;border-radius:15px;position:relative;background:#fff;align-self:flex-start;box-shadow:0 1px 2px rgba(0,0,0,0.1)}li b{display:block;font-size:0.8em;color:#2b5278}.my-msg{align-self:flex-end;background:#ffeb3b}.system{align-self:center;background:#d1ebe8;font-size:0.8em}#typing-monitor{padding:5px 20px;font-size:0.8em;color:#555;font-style:italic;height:20px}form{background:#fff;padding:10px;display:flex}input{flex-grow:1;border-radius:20px;border:1px solid #ddd;padding:10px;outline:none}</style></head><body><ul id='messages'></ul><div id='typing-monitor'></div><form id='form'><input id='input' autocomplete='off' placeholder='Сообщение...'/></form><script src='/socket.io/socket.io.js'></script><script>const socket=io(); const myName=prompt('Имя:')||'Гость'; socket.emit('set username', myName); const input=document.getElementById('input'); const typingDiv=document.getElementById('typing-monitor'); function addMsg(data){ const item=document.createElement('li'); if(data.user===myName) item.classList.add('my-msg'); if(data.user==='Система') item.classList.add('system'); item.innerHTML='<b>'+data.user+'</b>'+data.text; document.getElementById('messages').appendChild(item); messages.scrollTop=messages.scrollHeight; } socket.on('chat history', h=>h.forEach(addMsg)); socket.on('chat message', addMsg); socket.on('user typing', d=>{ typingDiv.innerText = d.typing ? d.user + ' печатает...' : ''; }); let typingTimer; input.addEventListener('input', ()=>{ socket.emit('typing', true); clearTimeout(typingTimer); typingTimer = setTimeout(()=>socket.emit('typing', false), 2000); }); document.getElementById('form').addEventListener('submit',e=>{ e.preventDefault(); if(input.value){ socket.emit('chat message', input.value); socket.emit('typing', false); input.value=''; } });</script></body></html>
